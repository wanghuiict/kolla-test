#!/bin/bash

show_help() {
        echo -e "install/uninstall TianNi Openstack.\nUsage:\n\t$0 <install|destroy|test> [options...] [parameters...]\nOptions:"
        echo -e "\t--help, -h              \tshow help."
        echo -e "\nParameters:"
        echo -e "\tinstall                 \tinstall openstack"
        echo -e "\tdestroy                 \tuninstall openstack"
        echo -e "\ttest                    \ttest kolla"
}

[ -z "$KOLLADIR" ] && . tn-openstack-var

cmdopts=$(getopt --longoptions help \
                     --options +h -- "$@")
if [ $? -ne 0 ] ; then
  echo "Terminating..." 1>&2
  exit 1
fi

# set positional parameters
eval set -- "$cmdopts"

[ $# -eq 1 ] && { show_help; exit 0; }

while true; do
  case "$1" in
    -h | --help )
        show_help
        exit ;;
    -- ) shift; break ;;
    * ) break ;;
  esac
done

while true; do
  case "$1" in
    install )
        shift
        exec call-kolla-install.sh -t "$0 install" $@
        exit $? ;;
    destroy )
        shift
        # swap options and parameter 'destroy'
        exec call-kolla-uninstall.sh -t "$0 destroy [options...]" $@ destroy
        exit $? ;;
    test )
        shift
        exec call-kolla-test.sh -t "$0 test" $@
        exit $? ;;
    -- ) shift; break ;;
    * )
        echo "error input" 1>&2
        break ;;
  esac
done
